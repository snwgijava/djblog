{% extends 'blog/blog_list.html' %}

{% block title %}{{ blog.title }}{% endblock %}

{% block nav_blog_active %}active{% endblock %}

{% block content %}

    <div class="col-sm-8 col-md-8">
        <div class="panel-body">
            <article class="flex-left list-group-item post-item px-7">
                <div class="unit unit-1-on-mobile">
                    <h3 class="top-gap-0 post-item-title"><a class=".media-heading"
                                                             href="{% url 'blog_detail' blog.pk %}">{{ blog.title }}</a>
                    </h3>
                    <div class="media-body meta">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span> {{ blog.author }}
                        <span> • </span>
                        <a href="{% url 'blogs_with_type' blog.blog_type.pk %}">
                            <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>
                            {{ blog.blog_type }}</a>
                        <span> • </span>
                        <span class="fas fa-eye"></span> {{ blog.get_read_num }}
                        <span> • </span>
                        <span class="far fa-calendar-alt"
                              aria-hidden="true"></span> {{ blog.created_time | date:"Y-m-d H:n:s" }}
                    </div>
                </div>
                <div class="blog-detail-content">
                    {% autoescape off %}
                        {{ blog.content }}
                    {% endautoescape %}
                </div>
                <br>
                <div class="blog-detail-up-down">
                    <div class="page-up text-left">
                        {% if previous_blog %}
                            <a href="{% url 'blog_detail' previous_blog.pk %}">
                                上一篇：{{ previous_blog.title | truncatechars:20 }}
                            </a>
                        {% else %}
                            上一篇：没有了
                        {% endif %}
                    </div>
                    <div class="page-down text-right">


                        {% if next_blog %}
                            <a href="{% url 'blog_detail' next_blog.pk %}">
                                下一篇：{{ next_blog.title | truncatechars:20 }}
                            </a>
                        {% else %}
                            下一篇：没有了
                        {% endif %}
                    </div>
                </div>
            </article>

        </div>

        <div class="col-xs-10 col-xs-offset-1">
            <div class="comment-area">
                <h3 class="comment-area-title">提交评论区域</h3>
                {% if request.user.is_authenticated %}
                    <form action="{% url 'update_comment' %}" method="post" style="overflow:hidden">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="exampleFormControlTextarea1">{{ user.username }}，欢迎评论</label>
                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="5" name="text"></textarea>
                        </div>
                        <input type="hidden" name="object_id" value="{{ blog.pk }}">
                        <input type="hidden" name="content_type" value="blog">
                        <button class="btn btn-primary" type="submit" value="评论" style="float:right">评论</button>
                    </form>
                {% else %}
                    未登录,登录之后进行评论
                    <a href="{% url 'login' %}?from={{ request.get_full_path }}">登录</a>
                {% endif %}

            </div>
            <div class="comment-area">
                <h3 class="comment-area-title">评论列表</h3>
                {% for comment in comments %}
                    <div>
                    {{ comment.user.username }}
                    ({{ comment.comment_time | date:"Y-m-d H:n:s" }}):
                    {{ comment.text }}
                    </div>
                    {% empty %}
                    暂无评论
                {% endfor %}
            </div>
        </div>

    </div>
{% endblock %}